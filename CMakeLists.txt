cmake_minimum_required(VERSION 3.12)
project(libffm CXX)

OPTION(USE_OPENMP "Enable OpenMP" OFF)
OPTION(USE_SSE "Enable SSE instructions" ON)

set(CMAKE_C_STANDARD 11)
SET(CMAKE_CXX_COMPILER g++)
set(CMAKE_VERBOSE_MAKEFILE ON)
set(CMAKE_CXX_FLAGS "-Wall -O3 -std=c++0x -march=native")

if(USE_SSE)
    SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -DUSESSE")
endif(USE_SSE)

add_library(ffm SHARED ffm.cpp timer.cpp)

if(USE_OPENMP)
    find_package(OpenMP)
    if (OpenMP_CXX_FOUND)
        target_link_libraries(ffm PUBLIC OpenMP::OpenMP_CXX)
    else()
        message(WARNING "OpenMP package is not found")
    endif(OpenMP_CXX_FOUND)
endif(USE_OPENMP)

add_executable(ffm-train ffm-train.cpp ffm.cpp timer.cpp)
add_executable(ffm-predict ffm-predict.cpp ffm.cpp timer.cpp)

# testing
add_subdirectory(tests)
